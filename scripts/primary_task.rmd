## Primary Tasks


```{r}
##MULTICLASS CLASSIFICATION USING SVM
library(tidyverse)
library(tidymodels)
library(e1071)
library(keras)
```

```{r}
# load cleaned data
load("data/claims-clean.RData")


# partition
set.seed(110122)
partitions <- claims_clean %>%
  initial_split(prop = 0.8)

train_text <- training(partitions) %>%
  pull(text_clean)
train_labels <- training(partitions) %>%
  pull(mclass)

# Test text for later
test_text <- testing(partitions) %>%
  pull(text_clean)
test_labels <- testing(partitions) %>%
  pull(mclass)
test_ids <- testing(partitions) %>%
  pull(.id)

# create a preprocessing layer
preprocess_layer <- layer_text_vectorization(
  standardize = NULL,
  split ="whitespace",
  ngrams = NULL,
  max_tokens = 5000, # Example token limit
  output_mode = "tf_idf"
)


# Fit the preprocessing layer to the training text
preprocess_layer %>% adapt(train_text)

# Preprocess text data
train_tfidf <- as.array(preprocess_layer(train_text))

# Train SVM Model
svm_model <- svm(
  x = train_tfidf,
  y = as.factor(train_labels),
  kernel = "linear",
  type = "C-classification"
)

# Save Model
saveRDS(svm_model, file = "results/bennett-multiclass-model.rds")
```

```{r}
# Load test data
load("data/claims-test.RData")

# Preprocess test data using the preprocessing layer
test_tfidf <- as.array(preprocess_layer(test_text))

# Make predictions on the test data
test_predictions <- predict(svm_model, newdata = test_tfidf)

# Create the predictions tibble
multiclass_pred_df <- tibble(
  .id = test_ids,
  mclass.pred = test_predictions
)

# HANNAH: Add the line below to your code as it will run after mine,
# add your prediction df below after multiclass_pred_df.
# I think our DFs look the same so it should work.
save(multiclass_pred_df, file = "results/preds-group12.RData")
```